{
  "prTitle": "feat: implement borrow and return book endpoints for library API",
  "prBody": "## Summary\n\nImplemented complete borrow and return book functionality for the Library Management API (Flask application) according to issue #101 requirements.\n\n### Key Features Implemented:\n\n**New API Endpoints:**\n- `POST /loans/borrow` - Borrow a book by creating a new loan record (auth required)\n- `POST /loans/return` - Return a borrowed book by updating loan status (auth required)  \n- `GET /loans/{id}` - Get detailed information about a specific loan (auth required)\n\n**Core Functionality:**\n- **Book Borrowing**: Creates loan records with automatic book availability tracking\n- **Book Returning**: Updates loan status and restores book availability\n- **Loan Tracking**: Complete loan lifecycle management with timestamps\n- **Data Consistency**: Automatically manages available_copies when books are borrowed/returned\n- **Authentication**: All loan endpoints require valid JWT authentication\n- **Validation**: Comprehensive input validation using existing validator functions\n\n### Implementation Details:\n\n**Borrow Book Endpoint (`POST /loans/borrow`)**:\n- Validates book_id and member_id existence and availability\n- Checks book availability (available_copies > 0)\n- Creates new loan record with status 'borrowed'\n- Decrements available_copies for the borrowed book\n- Returns detailed loan information with book and member details\n- Generates automatic borrow_date timestamp\n\n**Return Book Endpoint (`POST /loans/return`)**:\n- Validates loan_id exists and loan is currently borrowed\n- Updates loan status to 'returned' with return_date timestamp\n- Increments available_copies for the returned book\n- Returns comprehensive loan completion details\n- Prevents double-returns of same loan\n\n**Loan Details Endpoint (`GET /loans/{id})`**:\n- Retrieves complete loan information with book and member details\n- Shows borrow_date, return_date (if returned), and current status\n- Includes related book title and member name for easy reference\n\n### Data Store Integration:\n- Utilizes existing `LOANS`, `BOOKS`, `MEMBERS` data structures\n- Leverages existing `validate_loan()` and `validate_loan_return()` functions\n- Uses `get_next_loan_id()` for automatic ID generation\n- Maintains data consistency across all operations\n\n### Security & Error Handling:\n- All endpoints protected by `@token_required` decorator\n- Comprehensive error handling for invalid data, missing resources\n- Proper HTTP status codes (201 for creation, 200 for success, 400 for validation errors, 404 for not found)\n- Detailed error messages for debugging and user feedback\n- Input validation prevents invalid loan operations\n\n### API Response Format:\n\nBorrow Response:\n```json\n{\n  \"loan_id\": 2,\n  \"book_id\": 1,\n  \"member_id\": 1,\n  \"borrow_date\": \"2024-02-11\",\n  \"book_title\": \"The Great Gatsby\",\n  \"member_name\": \"John Doe\",\n  \"status\": \"borrowed\",\n  \"message\": \"Book 'The Great Gatsby' successfully borrowed by John Doe\"\n}\n```\n\nReturn Response:\n```json\n{\n  \"loan_id\": 2,\n  \"book_id\": 1,\n  \"member_id\": 1,\n  \"borrow_date\": \"2024-02-11\",\n  \"return_date\": \"2024-02-11\",\n  \"book_title\": \"The Great Gatsby\",\n  \"member_name\": \"John Doe\",\n  \"status\": \"returned\",\n  \"message\": \"Book 'The Great Gatsby' successfully returned by John Doe\"\n}\n```\n\n### Updated Root Endpoint:\nThe root endpoint (`GET /`) now includes the new loan endpoints in the API documentation:\n- `\"borrow_book\": \"/loans/borrow\"`\n- `\"return_book\": \"/loans/return\"`  \n- `\"loan_details\": \"/loans/{id}\"`\n\n### Testing:\nCreated comprehensive test suite (`test_loan_implementation.py`) that validates:\n- Module imports and loan validation functions\n- Flask endpoint functionality with proper authentication\n- Data consistency during borrow/return operations\n- Error handling for edge cases\n\n### Architecture Notes:\n- Built on existing Flask application (`api/app.py`) not FastAPI\n- Follows established patterns from existing book CRUD endpoints\n- Maintains consistent error handling and response formatting\n- Integrates seamlessly with existing authentication system\n\nThis implementation provides a complete, production-ready loan management system that enables library members to borrow and return books through the API while maintaining accurate book availability tracking.\n\nCloses #101",
  "testsPass": true,
  "filesChanged": [
    "api/app.py",
    "api/routes/__init__.py",
    "test_loan_implementation.py"
  ]
}