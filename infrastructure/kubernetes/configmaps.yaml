apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: f1-analytics
  labels:
    app: f1-analytics
    component: application-config
data:
  # Application Configuration
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"
  DEBUG: "false"
  API_VERSION: "v1"
  API_PREFIX: "/api/v1"

  # CORS Configuration
  CORS_ORIGINS: "https://f1-analytics.example.com,https://www.f1-analytics.example.com"
  CORS_ALLOW_CREDENTIALS: "true"
  CORS_MAX_AGE: "86400"

  # Rate Limiting Configuration
  RATE_LIMIT_REQUESTS: "100"
  RATE_LIMIT_WINDOW: "60"
  RATE_LIMIT_STORAGE: "redis"

  # Cache Configuration
  CACHE_DEFAULT_TTL: "3600"
  CACHE_PREDICTION_TTL: "604800"  # 7 days
  CACHE_RACE_DATA_TTL: "86400"    # 24 hours
  CACHE_WEATHER_TTL: "1800"       # 30 minutes

  # Database Configuration
  DB_POOL_SIZE: "20"
  DB_MAX_OVERFLOW: "30"
  DB_POOL_TIMEOUT: "30"
  DB_POOL_RECYCLE: "3600"
  DB_ECHO: "false"

  # Feature Flags
  FEATURE_EXPORT_ENABLED: "true"
  FEATURE_WEBSOCKETS_ENABLED: "true"
  FEATURE_ANALYTICS_ENABLED: "true"
  FEATURE_PUSH_NOTIFICATIONS: "false"
  FEATURE_ML_ENSEMBLE: "true"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: ml-config
  namespace: f1-analytics
  labels:
    app: f1-analytics
    component: ml-config
data:
  # ML Model Configuration
  MODEL_STORAGE_TYPE: "s3"
  MODEL_S3_PREFIX: "models/production/"
  MODEL_CACHE_PATH: "/app/models"
  MODEL_RELOAD_INTERVAL: "3600"  # 1 hour
  MODEL_MEMORY_LIMIT: "2048"     # MB

  # Feature Engineering Configuration
  FEATURE_CACHE_TTL: "86400"     # 24 hours
  ELO_UPDATE_INTERVAL: "3600"    # 1 hour
  ELO_K_FACTOR: "32"
  ELO_INITIAL_RATING: "1200"

  # Prediction Configuration
  PREDICTION_MODELS: "random_forest,xgboost,elo_rating"
  ENSEMBLE_WEIGHTS: "0.4,0.4,0.2"
  PREDICTION_CONFIDENCE_THRESHOLD: "0.1"
  MAX_PREDICTION_AGE_HOURS: "8"
  PREDICTION_BATCH_SIZE: "1000"

  # Model Training Configuration
  TRAINING_VALIDATION_SPLIT: "0.2"
  TRAINING_TEST_SPLIT: "0.1"
  TRAINING_RANDOM_STATE: "42"
  TRAINING_CV_FOLDS: "5"
  TRAINING_MAX_ITER: "1000"

  # Random Forest Configuration
  RF_N_ESTIMATORS: "200"
  RF_MAX_DEPTH: "15"
  RF_MIN_SAMPLES_SPLIT: "5"
  RF_MIN_SAMPLES_LEAF: "2"
  RF_MAX_FEATURES: "sqrt"

  # XGBoost Configuration
  XGB_N_ESTIMATORS: "300"
  XGB_MAX_DEPTH: "8"
  XGB_LEARNING_RATE: "0.1"
  XGB_SUBSAMPLE: "0.8"
  XGB_COLSAMPLE_BYTREE: "0.8"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: external-api-config
  namespace: f1-analytics
  labels:
    app: f1-analytics
    component: external-api-config
data:
  # Ergast API Configuration
  ERGAST_API_URL: "https://ergast.com/api/f1"
  ERGAST_API_TIMEOUT: "30"
  ERGAST_API_RETRIES: "3"
  ERGAST_API_BACKOFF_FACTOR: "2"
  ERGAST_API_RATE_LIMIT: "10"  # requests per minute

  # OpenWeatherMap API Configuration
  OPENWEATHER_API_URL: "https://api.openweathermap.org/data/2.5"
  OPENWEATHER_API_TIMEOUT: "15"
  OPENWEATHER_API_RETRIES: "3"
  OPENWEATHER_API_RATE_LIMIT: "1000"  # requests per minute

  # Circuit coordinates for weather data
  CIRCUIT_COORDINATES: |
    {
      "monaco": {"lat": 43.7347, "lon": 7.4206},
      "silverstone": {"lat": 52.0786, "lon": -1.0169},
      "spa": {"lat": 50.4372, "lon": 5.9714},
      "monza": {"lat": 45.6156, "lon": 9.2811},
      "suzuka": {"lat": 34.8431, "lon": 136.5411},
      "interlagos": {"lat": -23.7036, "lon": -46.6997},
      "albert_park": {"lat": -37.8497, "lon": 144.9680},
      "bahrain": {"lat": 26.0325, "lon": 50.5106},
      "imola": {"lat": 44.3439, "lon": 11.7167},
      "miami": {"lat": 25.7581, "lon": -80.2389},
      "barcelona": {"lat": 41.5700, "lon": 2.2611},
      "baku": {"lat": 40.3725, "lon": 49.8533},
      "canada": {"lat": 45.5019, "lon": -73.5228},
      "red_bull_ring": {"lat": 47.2197, "lon": 14.7647},
      "hungary": {"lat": 47.5789, "lon": 19.2486},
      "singapore": {"lat": 1.2914, "lon": 103.8640},
      "cota": {"lat": 30.1328, "lon": -97.6411},
      "mexico": {"lat": 19.4042, "lon": -99.0907},
      "las_vegas": {"lat": 36.1147, "lon": -115.1728},
      "qatar": {"lat": 25.4900, "lon": 51.4542},
      "abu_dhabi": {"lat": 24.4672, "lon": 54.6031}
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: monitoring-config
  namespace: f1-analytics
  labels:
    app: monitoring
    component: observability-config
data:
  # Prometheus Configuration
  PROMETHEUS_RETENTION: "30d"
  PROMETHEUS_SCRAPE_INTERVAL: "15s"
  PROMETHEUS_EVALUATION_INTERVAL: "15s"

  # Metrics Configuration
  METRICS_ENABLED: "true"
  METRICS_PORT: "9090"
  CUSTOM_METRICS_ENABLED: "true"

  # Alert Thresholds
  ALERT_CPU_THRESHOLD: "80"
  ALERT_MEMORY_THRESHOLD: "85"
  ALERT_DISK_THRESHOLD: "90"
  ALERT_API_ERROR_RATE: "5"      # percentage
  ALERT_API_LATENCY_P95: "2000"  # milliseconds
  ALERT_DATABASE_CONNECTIONS: "80"  # percentage of max

  # Grafana Configuration
  GRAFANA_RETENTION: "90d"
  GRAFANA_REFRESH_INTERVAL: "5s"

  # Logging Configuration
  LOG_FORMAT: "json"
  LOG_TIMESTAMP_FORMAT: "iso8601"
  ACCESS_LOG_ENABLED: "true"
  SLOW_QUERY_THRESHOLD: "1000"  # milliseconds
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: backup-config
  namespace: f1-analytics
  labels:
    app: f1-analytics
    component: backup-config
data:
  # Database Backup Configuration
  DB_BACKUP_SCHEDULE: "0 2 * * *"  # Daily at 2 AM
  DB_BACKUP_RETENTION: "30"        # days
  DB_BACKUP_COMPRESSION: "gzip"
  DB_BACKUP_S3_PREFIX: "database-backups/"

  # Model Backup Configuration
  MODEL_BACKUP_SCHEDULE: "0 4 * * 0"  # Weekly on Sunday at 4 AM
  MODEL_BACKUP_RETENTION: "90"        # days
  MODEL_BACKUP_S3_PREFIX: "model-backups/"

  # Logs Backup Configuration
  LOG_BACKUP_SCHEDULE: "0 3 * * *"   # Daily at 3 AM
  LOG_BACKUP_RETENTION: "7"          # days
  LOG_BACKUP_S3_PREFIX: "log-backups/"

  # Backup Verification
  BACKUP_VERIFICATION_ENABLED: "true"
  BACKUP_NOTIFICATION_ENABLED: "true"
  BACKUP_SLACK_CHANNEL: "#f1-analytics-ops"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: scheduler-config
  namespace: f1-analytics
  labels:
    app: airflow
    component: scheduler-config
data:
  # DAG Schedules
  F1_DATA_INGESTION_SCHEDULE: "0 6 * * *"    # Daily at 6 AM UTC
  MODEL_TRAINING_SCHEDULE: "0 2 * * 0"       # Weekly on Sunday at 2 AM UTC
  ELO_UPDATE_SCHEDULE: "0 */6 * * *"         # Every 6 hours
  PREDICTION_REFRESH_SCHEDULE: "0 */2 * * *" # Every 2 hours
  WEATHER_UPDATE_SCHEDULE: "*/30 * * * *"    # Every 30 minutes
  ACCURACY_CALCULATION_SCHEDULE: "0 8 * * 1" # Weekly on Monday at 8 AM

  # Task Configuration
  TASK_RETRIES: "3"
  TASK_RETRY_DELAY: "300"  # 5 minutes
  TASK_TIMEOUT: "3600"     # 1 hour
  TASK_POOL_SIZE: "16"

  # Data Quality Checks
  DATA_QUALITY_ENABLED: "true"
  DATA_QUALITY_SCHEDULE: "0 7 * * *"  # Daily at 7 AM
  DATA_QUALITY_THRESHOLDS: |
    {
      "missing_data_threshold": 0.05,
      "data_freshness_hours": 48,
      "accuracy_threshold": 0.70
    }

  # Notification Configuration
  NOTIFICATION_ON_FAILURE: "true"
  NOTIFICATION_ON_SUCCESS: "false"
  NOTIFICATION_ON_RETRY: "true"
  NOTIFICATION_EMAIL: "admin@f1-analytics.example.com"
---
# Environment-specific ConfigMap for Staging
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: f1-analytics-staging
  labels:
    app: f1-analytics
    component: application-config
    environment: staging
data:
  # Override configuration for staging environment
  ENVIRONMENT: "staging"
  LOG_LEVEL: "DEBUG"
  DEBUG: "true"
  API_VERSION: "v1"
  API_PREFIX: "/api/v1"

  # More permissive CORS for staging
  CORS_ORIGINS: "*"
  CORS_ALLOW_CREDENTIALS: "true"

  # Reduced cache TTLs for testing
  CACHE_DEFAULT_TTL: "300"       # 5 minutes
  CACHE_PREDICTION_TTL: "1800"   # 30 minutes
  CACHE_RACE_DATA_TTL: "600"     # 10 minutes

  # Feature flags for testing
  FEATURE_EXPORT_ENABLED: "true"
  FEATURE_WEBSOCKETS_ENABLED: "true"
  FEATURE_ANALYTICS_ENABLED: "true"
  FEATURE_PUSH_NOTIFICATIONS: "true"
  FEATURE_ML_ENSEMBLE: "true"
  FEATURE_DEBUG_MODE: "true"