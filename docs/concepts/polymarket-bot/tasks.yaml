GeneratedAt: "2026-02-16T15:38:28Z"
Plan: polymarket-bot-plan
Sprints:
- Features:
  - FeatureID: polymarket-bot-feat-unit-tests
    FeatureTitle: Unit Tests
    Tasks:
    - AcceptanceCriteria:
      - pytest runs successfully with proper test discovery
      - Mock factories for API responses and WebSocket streams are reusable across
        test modules
      - Shared fixtures for configuration and test data are available
      AgentType: qa-engineer
      Dependencies: []
      Description: Set up the test infrastructure including pytest configuration,
        shared fixtures, mock factories for external dependencies (Polymarket API,
        Binance WebSocket), and test utilities. Create the base test module structure
        with common test data generators for market data, price streams, and bot state.
      EstimatedEffort: M
      Files:
      - tests/__init__.py
      - tests/conftest.py
      - tests/fixtures.py
      ID: task-polymarket-bot-feat-unit-tests-1
      Title: Implement test infrastructure and fixtures
    - AcceptanceCriteria:
      - All MarketConnector methods tested with mocked requests including error paths
      - PriceDataProvider WebSocket lifecycle and reconnection tested with asyncio
        mocks
      - Test coverage >90% for both modules
      AgentType: qa-engineer
      Dependencies:
      - task-polymarket-bot-feat-unit-tests-1
      Description: Write comprehensive unit tests for MarketConnector covering API
        request/response handling, retry logic, error scenarios, and rate limiting.
        Implement PriceDataProvider tests covering WebSocket connection lifecycle,
        message parsing, reconnection logic, and price buffer management with mocked
        websocket connections.
      EstimatedEffort: L
      Files:
      - tests/test_market_connector.py
      - tests/test_price_provider.py
      ID: task-polymarket-bot-feat-unit-tests-2
      Title: Implement MarketConnector and PriceDataProvider tests
    - AcceptanceCriteria:
      - RSI and EMA calculations validated against expected values
      - Signal generation tested for buy/sell/hold scenarios
      - Edge cases handled (empty buffer, single data point, NaN values)
      AgentType: qa-engineer
      Dependencies:
      - task-polymarket-bot-feat-unit-tests-1
      Description: Write unit tests for PredictionEngine covering RSI and EMA calculation
        accuracy, signal generation logic, edge cases with insufficient data, and
        prediction output format. Use synthetic price data sequences to validate indicator
        calculations against known expected values from pandas-ta library.
      EstimatedEffort: M
      Files:
      - tests/test_prediction_engine.py
      ID: task-polymarket-bot-feat-unit-tests-3
      Title: Implement PredictionEngine tests
    - AcceptanceCriteria:
      - CapitalAllocator position sizing tested across win-streak scenarios with Decimal
        accuracy
      - RiskManager correctly triggers stops at drawdown and volatility thresholds
      - Test coverage >90% for both modules
      AgentType: qa-engineer
      Dependencies:
      - task-polymarket-bot-feat-unit-tests-1
      Description: Write unit tests for CapitalAllocator covering position sizing
        logic, win-streak scaling calculations, Decimal precision handling, and capital
        limits. Implement RiskManager tests covering drawdown monitoring, volatility
        thresholds, emergency stop conditions, and risk metrics calculations with
        various portfolio scenarios.
      EstimatedEffort: L
      Files:
      - tests/test_capital_allocator.py
      - tests/test_risk_manager.py
      ID: task-polymarket-bot-feat-unit-tests-4
      Title: Implement CapitalAllocator and RiskManager tests
    - AcceptanceCriteria:
      - StateManager handles file I/O errors and atomic writes correctly
      - Integration tests validate complete trade cycles with mocked APIs
      - State recovery from crashes tested with partial state files
      AgentType: qa-engineer
      Dependencies:
      - task-polymarket-bot-feat-unit-tests-2
      - task-polymarket-bot-feat-unit-tests-3
      - task-polymarket-bot-feat-unit-tests-4
      Description: Write unit tests for StateManager covering JSON serialization/deserialization,
        atomic file operations, crash recovery scenarios, and state migration. Create
        integration tests that verify end-to-end workflows with all components working
        together using mocked external dependencies, validating orchestrator coordination
        and state persistence across trade cycles.
      EstimatedEffort: M
      Files:
      - tests/test_state_manager.py
      - tests/test_integration.py
      ID: task-polymarket-bot-feat-unit-tests-5
      Title: Implement StateManager and integration test suite
  - FeatureID: polymarket-bot-feat-integration-tests
    FeatureTitle: Integration and E2E Tests
    Tasks:
    - AcceptanceCriteria:
      - Win streak scaling test verifies capital allocation increases after consecutive
        wins
      - Emergency stop test confirms bot halts on drawdown threshold breach
      - Volatility filter test validates trade blocking during high volatility periods
      - Crash recovery test ensures state restoration from persisted JSON after simulated
        failure
      AgentType: qa-engineer
      Dependencies: []
      Description: Create integration test suite covering win streak scaling, emergency
        stop triggers, volatility filtering, and crash recovery scenarios. Tests should
        validate component interactions across multiple 3-minute intervals with mocked
        API responses and state persistence.
      EstimatedEffort: L
      Files:
      - tests/test_integration.py
      ID: task-polymarket-bot-feat-integration-tests-1
      Title: Implement multi-interval integration tests
    - AcceptanceCriteria:
      - E2E test executes 30 consecutive 3-minute intervals without timing drift
      - Test validates proper sequence of fetch price, analyze, allocate, execute,
        and persist operations
      - Comprehensive assertions verify final state matches expected outcomes from
        simulated market data
      AgentType: qa-engineer
      Dependencies:
      - task-polymarket-bot-feat-integration-tests-1
      Description: Create end-to-end test simulating complete 90-minute trading session
        (30 intervals) with realistic market conditions, API latency, and state transitions.
        Test should validate orchestrator timing, drift correction, and complete workflow
        from startup to shutdown.
      EstimatedEffort: M
      Files:
      - tests/test_integration.py
      ID: task-polymarket-bot-feat-integration-tests-2
      Title: Implement full 90-minute E2E simulation
  Sprint: 5
- Features:
  - FeatureID: polymarket-bot-feat-project-setup
    FeatureTitle: Project Setup and Configuration
    Tasks:
    - AcceptanceCriteria:
      - requirements.txt includes all dependencies (py-clob-client, pandas, aiohttp,
        python-dotenv) with pinned versions
      - config.py successfully loads and validates all required environment variables
        from .env
      - .env.example documents all required configuration variables
      - README.md includes clear setup and installation instructions
      AgentType: backend-engineer
      Dependencies: []
      Description: Create the foundational project structure including requirements.txt
        with pinned dependencies, environment configuration template (.env.example),
        gitignore rules, basic README with setup instructions, and config.py for loading
        and validating environment variables.
      EstimatedEffort: S
      Files:
      - requirements.txt
      - .env.example
      - .gitignore
      - README.md
      - config.py
      ID: task-polymarket-bot-feat-project-setup-1
      Title: Initialize project structure and configuration
    - AcceptanceCriteria:
      - Retry decorator successfully retries failed function calls with exponential
        backoff
      - Max attempts and delay parameters are configurable
      - Decorator works with both sync and async functions
      - Failed attempts are logged with appropriate detail
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-project-setup-1
      Description: Create a reusable retry decorator in utils/retry.py that implements
        exponential backoff for API calls. Support configurable max attempts, base
        delay, and max delay with proper error handling and logging.
      EstimatedEffort: S
      Files:
      - utils/__init__.py
      - utils/retry.py
      ID: task-polymarket-bot-feat-project-setup-2
      Title: Implement retry utility with exponential backoff
    - AcceptanceCriteria:
      - NTP client successfully queries time servers and calculates drift
      - Validation raises error if drift exceeds threshold (2 seconds)
      - Multiple NTP servers are tried with fallback logic
      - Time sync check can be called at bot startup
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-project-setup-1
      Description: Create time sync validation utility in utils/time_sync.py that
        uses NTP to detect clock drift. Implement checks to ensure local system time
        is within acceptable bounds (±2 seconds) to prevent order timestamp issues.
      EstimatedEffort: M
      Files:
      - utils/time_sync.py
      ID: task-polymarket-bot-feat-project-setup-3
      Title: Implement time synchronization validation
    - AcceptanceCriteria:
      - Z-score calculation correctly identifies price outliers beyond threshold (default
        3.0)
      - Rolling window maintains recent price history for statistical analysis
      - Anomaly detection returns boolean flag and deviation magnitude
      - Function handles edge cases (insufficient data, NaN values)
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-project-setup-1
      Description: Create validation utility in utils/validation.py to detect price
        anomalies using z-score analysis. Implement outlier detection for BTC price
        feeds to prevent trading on corrupt or stale data, with configurable thresholds
        and rolling window statistics.
      EstimatedEffort: M
      Files:
      - utils/validation.py
      ID: task-polymarket-bot-feat-project-setup-4
      Title: Implement price anomaly detection
    - AcceptanceCriteria:
      - data/ directory structure is created with placeholder files
      - data/ directory is properly excluded in .gitignore
      - JSON and JSONL file formats are documented
      - Directory creation is handled gracefully if it doesn't exist
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-project-setup-1
      Description: Set up the data/ directory structure for state persistence and
        logging. Create initial templates for bot_state.json and ensure directory
        is properly gitignored while .example files provide structure documentation.
      EstimatedEffort: S
      Files:
      - .gitignore
      - data/.gitkeep
      ID: task-polymarket-bot-feat-project-setup-5
      Title: Create data directory structure and state file templates
  - FeatureID: polymarket-bot-feat-data-models
    FeatureTitle: Core Data Models
    Tasks:
    - AcceptanceCriteria:
      - BotState dataclass includes all required fields from LLD Section 3 (capital,
        positions list, trade history, win streak counter, start time)
      - Position dataclass includes market_id, side, size, entry_price, entry_time
        with proper types
      - Both classes serialize/deserialize correctly via to_dict() and from_dict()
        methods
      - Basic unit tests verify serialization round-trips preserve data
      AgentType: backend-engineer
      Dependencies: []
      Description: Create BotState dataclass to track capital, positions, trade history,
        and win streak. Create Position dataclass to represent active market positions
        with entry price, size, and timestamp. Both should include to_dict() and from_dict()
        serialization methods for JSON persistence.
      EstimatedEffort: S
      Files:
      - models/__init__.py
      - models/bot_state.py
      - models/position.py
      ID: task-polymarket-bot-feat-data-models-1
      Title: Implement BotState and Position dataclasses
    - AcceptanceCriteria:
      - Prediction dataclass includes timestamp, rsi_value, ema_short, ema_long, signal
        (YES/NO/NONE), confidence (0.0-1.0)
      - PricePoint dataclass includes timestamp and price with Decimal precision
      - Serialization methods handle Decimal and datetime types correctly
      - Unit tests verify data integrity after serialization
      AgentType: backend-engineer
      Dependencies: []
      Description: Create Prediction dataclass to hold RSI and EMA values with trend
        direction and signal strength. Create PricePoint dataclass for timestamped
        BTC/USD prices. Both should support serialization for logging and state persistence.
      EstimatedEffort: S
      Files:
      - models/__init__.py
      - models/prediction.py
      ID: task-polymarket-bot-feat-data-models-2
      Title: Implement Prediction and PricePoint dataclasses
    - AcceptanceCriteria:
      - TradeOutcome dataclass includes market_id, side, size, entry_price, exit_price,
        pnl, settlement_time, win_streak_at_trade
      - All models properly exported from models/__init__.py
      - Validation logic prevents invalid state (e.g., negative capital, invalid confidence
        ranges)
      - Integration tests verify models work together for common workflows (open position,
        record trade outcome, update bot state)
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-data-models-1
      - task-polymarket-bot-feat-data-models-2
      Description: Create TradeOutcome dataclass to record trade execution results
        including market_id, side, size, entry/exit prices, profit/loss, and settlement
        timestamp. Update models/__init__.py to export all dataclasses. Add validation
        logic to ensure data integrity across models.
      EstimatedEffort: M
      Files:
      - models/__init__.py
      - models/trade_outcome.py
      - models/bot_state.py
      ID: task-polymarket-bot-feat-data-models-3
      Title: Implement TradeOutcome dataclass and model integration
  Sprint: 1
- Features:
  - FeatureID: polymarket-bot-feat-state-persistence
    FeatureTitle: State Persistence
    Tasks:
    - AcceptanceCriteria:
      - StateManager loads and saves BotState from/to JSON with atomic file operations
      - Atomic write-replace prevents state corruption on crashes
      - Equity curve export to CSV works correctly
      - Directory creation and error handling function properly
      AgentType: backend-engineer
      Dependencies: []
      Description: Implement the complete StateManager class in core/state_manager.py
        with JSON-based state loading/saving, atomic write-replace operations for
        crash safety, and equity curve CSV export functionality. Include proper error
        handling, directory creation, and logging.
      EstimatedEffort: S
      Files:
      - core/state_manager.py
      ID: task-polymarket-bot-feat-state-persistence-1
      Title: Implement StateManager with atomic persistence
  - FeatureID: polymarket-bot-feat-logging
    FeatureTitle: Structured Logging
    Tasks:
    - AcceptanceCriteria:
      - BotLogger successfully logs predictions to predictions.jsonl and console
      - BotLogger successfully logs trade outcomes to trades.jsonl and console
      - Async file operations work without blocking
      - Error handling prevents logger failures from crashing the bot
      AgentType: backend-engineer
      Dependencies: []
      Description: Create core/logger.py with BotLogger class supporting async JSONL
        logging for predictions and trades, console output for real-time monitoring,
        and proper error handling. Includes both file-based JSONL logs and human-readable
        console/file logging.
      EstimatedEffort: S
      Files:
      - core/logger.py
      ID: task-polymarket-bot-feat-logging-1
      Title: Implement BotLogger with async JSONL logging
  - FeatureID: polymarket-bot-feat-price-feed
    FeatureTitle: BTC Price Data Provider
    Tasks:
    - AcceptanceCriteria:
      - WebSocket successfully connects to Binance and receives real-time BTC prices
      - Rolling buffer maintains exactly 60 price points with proper deque management
      - REST fallback activates when WebSocket fails, trying Coinbase then CoinGecko
      - Price validation rejects anomalies (>5% deviation and >3x baseline volatility)
      AgentType: backend-engineer
      Dependencies: []
      Description: Implement the complete PriceDataProvider class with Binance WebSocket
        connection, rolling 60-price buffer (30-second intervals), and REST API fallbacks
        to Coinbase/CoinGecko. Include connection management, price validation, anomaly
        detection, and volatility calculation methods.
      EstimatedEffort: M
      Files:
      - core/price_provider.py
      ID: task-polymarket-bot-feat-price-feed-1
      Title: Implement PriceDataProvider with WebSocket and REST fallback
    - AcceptanceCriteria:
      - Unit tests cover all validation and calculation methods with >80% coverage
      - Integration tests verify WebSocket connection and fallback behavior
      - Tests validate anomaly detection triggers correctly (5% deviation, 3x volatility)
      - All tests pass in CI environment
      AgentType: qa-engineer
      Dependencies:
      - task-polymarket-bot-feat-price-feed-1
      Description: Create comprehensive test suite covering WebSocket connection handling,
        REST API fallbacks, price validation logic, buffer management, and error scenarios.
        Include mocked API responses and WebSocket failures.
      EstimatedEffort: M
      Files:
      - tests/test_price_provider.py
      ID: task-polymarket-bot-feat-price-feed-2
      Title: Add unit tests and integration tests for PriceDataProvider
  Sprint: 2
- Features:
  - FeatureID: polymarket-bot-feat-market-connector
    FeatureTitle: Polymarket API Integration
    Tasks:
    - AcceptanceCriteria:
      - MarketConnector authenticates and makes successful API calls
      - Retry logic handles transient errors (429, 500, 502, 503) with exponential
        backoff
      - Settlement polling works with 15s intervals and timeout handling
      - Auth errors (401/403) raise exceptions without retry
      AgentType: backend-engineer
      Dependencies: []
      Description: Implement the complete MarketConnector class with authentication,
        market data fetching, order submission, and settlement polling. Include retry
        logic with exponential backoff and comprehensive error handling for different
        HTTP status codes.
      EstimatedEffort: M
      Files:
      - core/market_connector.py
      ID: task-polymarket-bot-feat-market-connector-1
      Title: Implement MarketConnector with API integration
    - AcceptanceCriteria:
      - Tests cover all public methods with success and error cases
      - Retry logic is verified with mocked transient failures
      - Settlement polling timeout behavior is tested
      - Test coverage exceeds 90%
      AgentType: qa-engineer
      Dependencies:
      - task-polymarket-bot-feat-market-connector-1
      Description: Create comprehensive unit tests covering all MarketConnector methods,
        retry scenarios, error handling paths, and settlement polling logic. Mock
        HTTP responses to test success and failure cases.
      EstimatedEffort: S
      Files:
      - tests/test_market_connector.py
      ID: task-polymarket-bot-feat-market-connector-2
      Title: Add unit tests for MarketConnector
  - FeatureID: polymarket-bot-feat-prediction-engine
    FeatureTitle: Prediction Engine
    Tasks:
    - AcceptanceCriteria:
      - PredictionEngine calculates RSI, EMA indicators correctly using pandas-ta
      - Signal rules correctly identify RSI_OVERSOLD, RSI_OVERBOUGHT, EMA crossovers
      - Returns Prediction objects with all required fields and confidence levels
      - Unit tests verify indicator calculations and signal logic
      AgentType: backend-engineer
      Dependencies: []
      Description: Implement the complete PredictionEngine class in core/prediction_engine.py
        with RSI (14-period) and EMA (9/21) calculations using pandas-ta. Include
        deterministic signal rules for RSI oversold/overbought and EMA crossover detection
        with confidence levels.
      EstimatedEffort: M
      Files:
      - core/prediction_engine.py
      ID: task-polymarket-bot-feat-prediction-engine-1
      Title: Implement PredictionEngine with RSI and EMA indicators
  - FeatureID: polymarket-bot-feat-capital-allocation
    FeatureTitle: Capital Allocation Strategy
    Tasks:
    - AcceptanceCriteria:
      - CapitalAllocator correctly calculates position sizes with win-streak scaling
        (base=$5, multiplier=1.5x, max=$30)
      - Position sizes are capped at both max_exposure and current_equity, rounded
        down to 2 decimal places
      - Win streak increments on wins and resets to 0 on losses
      - Unit tests verify all calculation paths, validation logic, and edge cases
      AgentType: backend-engineer
      Dependencies: []
      Description: Create the CapitalAllocator class in core/capital_allocator.py
        with Decimal-based capital tracking, win-streak scaling logic (1.5x multiplier),
        position size calculation with $5 base and $30 max exposure caps, equity validation,
        and post-trade update methods. Include comprehensive unit tests covering edge
        cases like streak scaling, equity constraints, and Decimal precision.
      EstimatedEffort: S
      Files:
      - core/capital_allocator.py
      - tests/test_capital_allocator.py
      ID: task-polymarket-bot-feat-capital-allocation-1
      Title: Implement CapitalAllocator with win-streak position sizing
  Sprint: 3
- Features:
  - FeatureID: polymarket-bot-feat-risk-management
    FeatureTitle: Risk Management Controls
    Tasks:
    - AcceptanceCriteria:
      - RiskManager class correctly calculates drawdown percentage and triggers emergency
        stop at 30% threshold
      - Volatility filter blocks trading when current volatility exceeds 2x baseline
      - Emergency stop flag persists once triggered and is queryable
      - Critical log messages emitted for emergency stop and warnings for volatility
        filter
      AgentType: backend-engineer
      Dependencies: []
      Description: Create core/risk_manager.py with the RiskManager class implementing
        30% max drawdown monitoring, 2x volatility filtering, and emergency stop mechanism.
        Include initialization with configurable thresholds, check_drawdown() for
        equity monitoring, check_volatility() for baseline comparison, and is_emergency_stop()
        for status queries. Add appropriate logging for critical events.
      EstimatedEffort: S
      Files:
      - core/risk_manager.py
      ID: task-polymarket-bot-feat-risk-management-1
      Title: Implement RiskManager with drawdown and volatility controls
  - FeatureID: polymarket-bot-feat-orchestrator
    FeatureTitle: Main Execution Orchestrator
    Tasks:
    - AcceptanceCriteria:
      - Application starts successfully and loads configuration from .env file
      - Graceful shutdown on SIGTERM/SIGINT releases all resources
      - Configuration validation fails fast with clear error messages
      - Application can be invoked via 'python main.py' with optional CLI flags
      AgentType: backend-engineer
      Dependencies: []
      Description: Create the main.py entry point with CLI argument parsing, environment
        configuration loading via config.py, and application initialization sequence.
        Implement graceful shutdown handlers for SIGTERM/SIGINT signals and basic
        error handling for startup failures.
      EstimatedEffort: M
      Files:
      - polymarket-bot/main.py
      - polymarket-bot/config.py
      ID: task-polymarket-bot-feat-orchestrator-1
      Title: Implement main.py orchestrator and configuration loading
    - AcceptanceCriteria:
      - Loop executes at precise 18-interval boundaries with drift correction
      - All components are initialized in correct dependency order
      - Each cycle coordinates prediction → allocation → risk checks → execution
      - Loop continues running until shutdown signal received
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-orchestrator-1
      Description: Build the core orchestration loop in main.py that executes trading
        cycles every 18 intervals with drift correction. Implement component initialization
        sequence, coordinated calls to all trading components (prediction, allocation,
        risk checks, execution), and timing logic to maintain consistent 18-interval
        cadence despite execution time variations.
      EstimatedEffort: L
      Files:
      - polymarket-bot/main.py
      ID: task-polymarket-bot-feat-orchestrator-2
      Title: Implement 18-interval execution loop with time-based scheduling
    - AcceptanceCriteria:
      - Bot successfully loads and validates state on startup from data/bot_state.json
      - State is persisted after each trade settlement and on graceful shutdown
      - First run creates initial state with default values
      - Invalid or corrupted state files are detected and handled with clear errors
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-orchestrator-2
      Description: Add startup state recovery logic that loads previous bot state
        via StateManager and resumes operation from last known position. Coordinate
        state persistence after each trade settlement and before shutdown. Handle
        first-run initialization when no prior state exists.
      EstimatedEffort: M
      Files:
      - polymarket-bot/main.py
      ID: task-polymarket-bot-feat-orchestrator-3
      Title: Implement state recovery and persistence coordination
    - AcceptanceCriteria:
      - Transient API failures trigger retries without stopping execution loop
      - Critical component failures log errors and trigger graceful shutdown
      - Uncaught exceptions are logged with full stack traces
      - Bot can recover from individual cycle failures and continue operation
      AgentType: backend-engineer
      Dependencies:
      - task-polymarket-bot-feat-orchestrator-2
      Description: Implement comprehensive error handling for component failures,
        API errors, and unexpected exceptions during execution loop. Add retry logic
        for transient failures, circuit breaker for repeated errors, and safe degradation
        modes. Ensure errors are logged appropriately and don't crash the orchestrator.
      EstimatedEffort: M
      Files:
      - polymarket-bot/main.py
      ID: task-polymarket-bot-feat-orchestrator-4
      Title: Add error handling and resilience mechanisms
  Sprint: 4
